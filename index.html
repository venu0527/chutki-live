<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chutki Live – Global Event Finder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2.39.7/dist/umd/supabase.js"></script>
  <style>
    html { scroll-behavior: smooth; }
    .scroll-x { display: flex; overflow-x: auto; gap: 1rem; scroll-snap-type: x mandatory; }
    .scroll-x::-webkit-scrollbar { display: none; }
    .event-card { flex: 0 0 auto; scroll-snap-align: start; min-width: 250px; }
    .modal { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); }
    @keyframes scrollX { 0% {transform: translateX(0);} 100% {transform: translateX(-50%);} }
  </style>
</head>
<body class="bg-gradient-to-b from-purple-50 to-white text-gray-800">

  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/70 backdrop-blur-md shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-3xl font-extrabold text-purple-600 tracking-tight">🎉 Chutki Live</h1>
      <div class="space-x-3">
        <button id="signinBtn" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-xl shadow-md">Sign In</button>
        <button id="adminBtn" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-xl shadow-md">Admin</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="text-center py-12 bg-gradient-to-r from-purple-100 to-pink-100">
    <h2 class="text-5xl font-bold mb-3">Discover & Share Events Worldwide 🌍</h2>
    <p class="text-lg text-gray-700 mb-6">Trending, upcoming, and virtual events — all in one place.</p>
    <button id="addEventBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-xl shadow-lg">Post Your Event</button>
  </section>

  <!-- Search -->
  <section class="max-w-5xl mx-auto px-4 py-8">
    <div class="grid md:grid-cols-4 gap-3">
      <input id="searchInput" type="text" placeholder="🔍 Search events..." class="p-3 border rounded-xl w-full">
      <select id="categoryFilter" class="p-3 border rounded-xl">
        <option value="">All Categories</option>
        <option>Music</option><option>Sports</option><option>Tech</option><option>Business</option>
      </select>
      <input id="dateFilter" type="date" class="p-3 border rounded-xl">
      <button id="gpsBtn" class="bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-xl">📍 Near Me</button>
    </div>
  </section>

  <!-- Event Sections -->
  <main class="max-w-6xl mx-auto px-4 space-y-10">
    <div><h3 class="text-2xl font-semibold mb-3">🔥 Trending Events</h3><div id="trending" class="scroll-x"></div></div>
    <div><h3 class="text-2xl font-semibold mb-3">🗓️ Upcoming Events</h3><div id="upcoming" class="scroll-x"></div></div>
    <div><h3 class="text-2xl font-semibold mb-3">🎬 Promo Events</h3><div id="promo" class="scroll-x"></div></div>
    <div><h3 class="text-2xl font-semibold mb-3">💻 Virtual Events</h3><div id="virtual" class="scroll-x"></div></div>
    <div><h3 class="text-2xl font-semibold mb-3">🌎 Events Around the World</h3><div id="global" class="scroll-x"></div></div>
  </main>

  <!-- Contact -->
  <section class="max-w-4xl mx-auto px-4 py-12">
    <h3 class="text-3xl font-bold mb-4 text-center">📬 Contact Us</h3>
    <form id="contactForm" class="space-y-3 bg-white p-6 rounded-2xl shadow-lg">
      <input name="name" placeholder="Your Name" class="w-full p-3 border rounded-xl" required>
      <input name="email" type="email" placeholder="Your Email" class="w-full p-3 border rounded-xl" required>
      <textarea name="message" rows="4" placeholder="Your Message" class="w-full p-3 border rounded-xl" required></textarea>
      <button class="bg-purple-600 hover:bg-purple-700 text-white px-5 py-2 rounded-xl w-full">Send</button>
    </form>
  </section>

  <footer class="text-center py-6 bg-gray-100 text-gray-500">
    © 2025 Chutki Live — All Rights Reserved.
  </footer>

  <!-- Modal -->
  <div id="eventModal" class="modal hidden">
    <div class="bg-white p-6 rounded-2xl shadow-xl w-11/12 md:w-1/2 relative">
      <button id="closeModal" class="absolute top-2 right-3 text-gray-500 text-2xl">&times;</button>
      <h3 class="text-2xl font-bold mb-4 text-purple-700">📝 Post a New Event</h3>
      <form id="eventForm" class="space-y-3">
        <input name="title" placeholder="Event Title" class="w-full p-3 border rounded-xl" required>
        <input name="category" placeholder="Category (Music, Tech...)" class="w-full p-3 border rounded-xl" required>
        <input name="location" placeholder="Location (or 'Virtual')" class="w-full p-3 border rounded-xl">
        <input name="date" type="date" class="w-full p-3 border rounded-xl" required>
        <textarea name="description" rows="3" placeholder="Event Description" class="w-full p-3 border rounded-xl"></textarea>
        <button class="bg-purple-600 hover:bg-purple-700 text-white px-5 py-2 rounded-xl w-full">Submit Event</button>
      </form>
    </div>
  </div>

  <script>
  const SUPABASE_URL = "https://rbnkhubtltjybaykdrgf.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJibmtodWJ0bHRqeWJheWtkcmdmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1Njg2MTAsImV4cCI6MjA3NjE0NDYxMH0.EqBPx2aShr5MTsLd7nDuvmsuFYAQhNAKIrtLrX_VYfQ";
  const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const trending = document.getElementById("trending");
  const upcoming = document.getElementById("upcoming");
  const virtual = document.getElementById("virtual");
  const promo = document.getElementById("promo");
  const global = document.getElementById("global");

  async function loadEvents() {
    const { data, error } = await client.from("events").select("*").eq("status","approved").order("date",{ascending:true});
    if (error) return console.error(error);
    [trending, upcoming, virtual, promo, global].forEach(s => s.innerHTML="");
    data.forEach(ev=>{
      const card = `<div class="event-card bg-white rounded-2xl p-4 shadow hover:shadow-lg transition">
        <h4 class="font-bold text-lg mb-2">${ev.title}</h4>
        <p class="text-sm text-gray-600">${ev.category} • ${new Date(ev.date).toLocaleDateString()}</p>
        <p class="mt-2 text-gray-700">${ev.location||'Virtual'}</p>
      </div>`;
      if(ev.category.toLowerCase().includes("promo")) promo.innerHTML+=card;
      else if(ev.category.toLowerCase().includes("virtual")) virtual.innerHTML+=card;
      else if(new Date(ev.date)>new Date()) upcoming.innerHTML+=card;
      else if(ev.category.toLowerCase().includes("world")) global.innerHTML+=card;
      else trending.innerHTML+=card;
    });
    autoScroll([trending, upcoming, virtual, promo, global]);
  }

  function autoScroll(sections){
    sections.forEach(sec=>{
      let scrollAmount=0;
      setInterval(()=>{sec.scrollLeft+=1;scrollAmount++;if(scrollAmount>=sec.scrollWidth/2){sec.scrollLeft=0;scrollAmount=0;}},30);
    });
  }

  loadEvents();

  // Contact form
  document.getElementById("contactForm").addEventListener("submit",async(e)=>{
    e.preventDefault();
    const f=e.target;
    const {error}=await client.from("contact_messages").insert([{name:f.name.value,email:f.email.value,message:f.message.value}]);
    alert(error?"Error sending message.":"Message sent successfully!");
    if(!error)f.reset();
  });

  // Modal
  const modal=document.getElementById("eventModal");
  document.getElementById("addEventBtn").onclick=()=>modal.classList.remove("hidden");
  document.getElementById("closeModal").onclick=()=>modal.classList.add("hidden");

  // Event submit
  document.getElementById("eventForm").addEventListener("submit",async(e)=>{
    e.preventDefault();
    const f=e.target;
    const {error}=await client.from("events").insert([{title:f.title.value,category:f.category.value,location:f.location.value,date:f.date.value,description:f.description.value,status:"pending"}]);
    alert(error?"Failed to submit event.":"Event submitted successfully! Pending admin approval.");
    if(!error){f.reset();modal.classList.add("hidden");}
  });

  // Auth + Admin
  document.getElementById("signinBtn").onclick=async()=>{
    const {error}=await client.auth.signInWithOAuth({provider:"google"});
    if(error)alert(error.message);
  };
  document.getElementById("adminBtn").onclick=()=>window.open("https://chutki-live.vercel.app/admin","_blank");
  </script>
</body>
</html>
